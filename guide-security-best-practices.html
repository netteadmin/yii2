<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        
<link href="./assets/95ffbc2e/css/bootstrap.css" rel="stylesheet">
<link href="./assets/6ee26e89/solarized-light.css" rel="stylesheet">
<link href="./assets/da0a60fc/style.css" rel="stylesheet">
<script src="./assets/392f4030/jquery.js"></script>
<script src="./assets/95ffbc2e/js/bootstrap.js"></script>
<script src="./assets/c312f280/jssearch.js"></script>    <title>安全领域的最佳实践（Best Practices） - 安全（Security） - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w567" class="navbar-inverse navbar-fixed-top navbar"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w567-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">The Definitive Guide to Yii 2.0</a></div><div id="w567-collapse" class="collapse navbar-collapse"><ul id="w568" class="navbar-nav nav"><li><a href="./index.html">Class reference</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Extensions <span class="caret"></span></a><ul id="w569" class="dropdown-menu"><li><a href="./ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="./ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="./ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="./ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="./ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="./ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="./ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="./ext-httpclient-index.html" tabindex="-1">httpclient</a></li>
<li><a href="./ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="./ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="./ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="./ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="./ext-shell-index.html" tabindex="-1">shell</a></li>
<li><a href="./ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="./ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="./ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="./ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-551" data-toggle="collapse" data-parent="#navigation">介绍（Introduction） <b class="caret"></b></a><div id="navigation-551" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">关于 Yii（About Yii）</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">从 Yii 1.1 升级（Upgrading from Version 1.1）</a></div>
<a class="list-group-item" href="#navigation-552" data-toggle="collapse" data-parent="#navigation">入门（Getting Started） <b class="caret"></b></a><div id="navigation-552" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-prerequisites.html">你需要了解什么（What do you need to know）</a>
<a class="list-group-item" href="./guide-start-installation.html">安装 Yii（Installing Yii）</a>
<a class="list-group-item" href="./guide-start-workflow.html">运行应用（Running Applications）</a>
<a class="list-group-item" href="./guide-start-hello.html">第一次问候（Saying Hello）</a>
<a class="list-group-item" href="./guide-start-forms.html">使用 Forms（Working with Forms）</a>
<a class="list-group-item" href="./guide-start-databases.html">玩转 Databases（Working with Databases）</a>
<a class="list-group-item" href="./guide-start-gii.html">用 Gii 生成代码（Generating Code with Gii）</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">更上一层楼（Looking Ahead）</a></div>
<a class="list-group-item" href="#navigation-553" data-toggle="collapse" data-parent="#navigation">应用结构（Application Structure） <b class="caret"></b></a><div id="navigation-553" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">结构概述（Overview）</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">入口脚本（Entry Scripts）</a>
<a class="list-group-item" href="./guide-structure-applications.html">应用（Applications）</a>
<a class="list-group-item" href="./guide-structure-application-components.html">应用组件（Application Components）</a>
<a class="list-group-item" href="./guide-structure-controllers.html">控制器（Controllers）</a>
<a class="list-group-item" href="./guide-structure-models.html">模型（Models）</a>
<a class="list-group-item" href="./guide-structure-views.html">视图（Views）</a>
<a class="list-group-item" href="./guide-structure-modules.html">模块（Modules）</a>
<a class="list-group-item" href="./guide-structure-filters.html">过滤器（Filters）</a>
<a class="list-group-item" href="./guide-structure-widgets.html">小部件（Widgets）</a>
<a class="list-group-item" href="./guide-structure-assets.html">前端资源（Assets）</a>
<a class="list-group-item" href="./guide-structure-extensions.html">扩展（Extensions）</a></div>
<a class="list-group-item" href="#navigation-554" data-toggle="collapse" data-parent="#navigation">请求处理（Handling Requests） <b class="caret"></b></a><div id="navigation-554" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">运行概述（Overview）</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">引导（Bootstrapping）</a>
<a class="list-group-item" href="./guide-runtime-routing.html">路由引导与创建 URL（Routing and URL Creation）</a>
<a class="list-group-item" href="./guide-runtime-requests.html">请求（Requests）</a>
<a class="list-group-item" href="./guide-runtime-responses.html">响应（Responses）</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions and Cookies</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">错误处理（Handling Errors）</a>
<a class="list-group-item" href="./guide-runtime-logging.html">日志（Logging）</a></div>
<a class="list-group-item" href="#navigation-555" data-toggle="collapse" data-parent="#navigation">关键概念（Key Concepts） <b class="caret"></b></a><div id="navigation-555" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">组件（Components）</a>
<a class="list-group-item" href="./guide-concept-properties.html">属性（Properties）</a>
<a class="list-group-item" href="./guide-concept-events.html">事件（Events）</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">行为（Behaviors）</a>
<a class="list-group-item" href="./guide-concept-configurations.html">配置（Configurations）</a>
<a class="list-group-item" href="./guide-concept-aliases.html">别名（Aliases）</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">类自动加载（Class Autoloading）</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">服务定位器（Service Locator）</a>
<a class="list-group-item" href="./guide-concept-di-container.html">依赖注入容器（Dependency Injection Container）</a></div>
<a class="list-group-item" href="#navigation-556" data-toggle="collapse" data-parent="#navigation">配合数据库工作（Working with Databases） <b class="caret"></b></a><div id="navigation-556" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">数据库访问（Data Access Objects）</a>
<a class="list-group-item" href="./guide-db-query-builder.html">查询生成器（Query Builder）</a>
<a class="list-group-item" href="./guide-db-active-record.html">活动记录（Active Record）</a>
<a class="list-group-item" href="./guide-db-migrations.html">数据库迁移（Migrations）</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-sphinx/doc/guide">Sphinx</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-redis/doc/guide/2.0/zh-cn">Redis（yii2-redis）</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-mongodb/doc/guide">MongoDB</a>
<a class="list-group-item" href="https://www.yiiframework.com/extension/yiisoft/yii2-elasticsearch/doc/guide">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-557" data-toggle="collapse" data-parent="#navigation">接收用户数据（Getting Data from Users） <b class="caret"></b></a><div id="navigation-557" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">创建表单（Creating Forms）</a>
<a class="list-group-item" href="./guide-input-validation.html">输入验证（Validating Input）</a>
<a class="list-group-item" href="./guide-input-file-upload.html">文件上传（Uploading Files）</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">收集列表输入（Collecting Tabular Input）</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">多模型同时输入（Getting Data for Multiple Models）</a>
<a class="list-group-item" href="./guide-input-form-javascript.html">在客户端扩展 ActiveForm（Extending ActiveForm on the Client Side）</a></div>
<a class="list-group-item" href="#navigation-558" data-toggle="collapse" data-parent="#navigation">显示数据（Displaying Data） <b class="caret"></b></a><div id="navigation-558" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatting.html">格式化输出数据（Data Formatting）</a>
<a class="list-group-item" href="./guide-output-pagination.html">分页（Pagination）</a>
<a class="list-group-item" href="./guide-output-sorting.html">排序（Sorting）</a>
<a class="list-group-item" href="./guide-output-data-providers.html">数据提供器（Data Providers）</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">数据小部件（Data Widgets）</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">操作客户端脚本（Working with Client Scripts）</a>
<a class="list-group-item" href="./guide-output-theming.html">主题（Theming）</a></div>
<a class="list-group-item active" href="#navigation-559" data-toggle="collapse" data-parent="#navigation">安全（Security） <b class="caret"></b></a><div id="navigation-559" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-security-overview.html">概述（Overview）</a>
<a class="list-group-item" href="./guide-security-authentication.html">认证（Authentication）</a>
<a class="list-group-item" href="./guide-security-authorization.html">授权（Authorization）</a>
<a class="list-group-item" href="./guide-security-passwords.html">处理密码（Working with Passwords）</a>
<a class="list-group-item" href="./guide-security-cryptography.html">加密（Cryptography）</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-authclient/blob/master/docs/guide-zh-CN/README.md">客户端认证（Auth Clients）</a>
<a class="list-group-item active" href="./guide-security-best-practices.html">安全领域的最佳实践（Best Practices）</a></div>
<a class="list-group-item" href="#navigation-560" data-toggle="collapse" data-parent="#navigation">缓存（Caching） <b class="caret"></b></a><div id="navigation-560" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">概述（Overview）</a>
<a class="list-group-item" href="./guide-caching-data.html">数据缓存（Data Caching）</a>
<a class="list-group-item" href="./guide-caching-fragment.html">片段缓存（Fragment Caching）</a>
<a class="list-group-item" href="./guide-caching-page.html">页面缓存（Page Caching）</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP 缓存（HTTP Caching）</a></div>
<a class="list-group-item" href="#navigation-561" data-toggle="collapse" data-parent="#navigation">RESTful Web 服务（RESTful Web Services） <b class="caret"></b></a><div id="navigation-561" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">快速入门（Quick Start）</a>
<a class="list-group-item" href="./guide-rest-resources.html">资源（Resources）</a>
<a class="list-group-item" href="./guide-rest-controllers.html">控制器（Controllers）</a>
<a class="list-group-item" href="./guide-rest-routing.html">路由（Routing）</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">格式化响应（Response Formatting）</a>
<a class="list-group-item" href="./guide-rest-authentication.html">授权验证（Authentication）</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">速率限制（Rate Limiting）</a>
<a class="list-group-item" href="./guide-rest-versioning.html">版本化（Versioning）</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">错误处理（Error Handling）</a></div>
<a class="list-group-item" href="#navigation-562" data-toggle="collapse" data-parent="#navigation">开发工具（Development Tools） <b class="caret"></b></a><div id="navigation-562" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-debug/blob/master/docs/guide-zh-CN/README.md">调试工具栏和调试器（Debug Toolbar and Debugger）</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-gii/blob/master/docs/guide-zh-CN/README.md">使用 Gii 生成代码（Generating Code using Gii）</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-apidoc">生成 API 文档（Generating API Documentation）</a></div>
<a class="list-group-item" href="#navigation-563" data-toggle="collapse" data-parent="#navigation">测试（Testing） <b class="caret"></b></a><div id="navigation-563" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">概述（Overview）</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">搭建测试环境（Testing environment setup）</a>
<a class="list-group-item" href="./guide-test-unit.html">单元测试（Unit Tests）</a>
<a class="list-group-item" href="./guide-test-functional.html">功能测试（Functional Tests）</a>
<a class="list-group-item" href="./guide-test-acceptance.html">验收测试（Acceptance Tests）</a>
<a class="list-group-item" href="./guide-test-fixtures.html">测试夹具（Fixtures）</a></div>
<a class="list-group-item" href="#navigation-564" data-toggle="collapse" data-parent="#navigation">高级专题（Special Topics） <b class="caret"></b></a><div id="navigation-564" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide-zh-CN/README.md">高级应用模版（Advanced Project Template）</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">从头构建自定义模版（Building Application from Scratch）</a>
<a class="list-group-item" href="./guide-tutorial-console.html">控制台命令（Console Commands）</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">核心验证器（Core Validators）</a>
<a class="list-group-item" href="./guide-tutorial-docker.html">Docker</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">国际化（Internationalization）</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">收发邮件（Mailing）</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">性能优化（Performance Tuning）</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">共享主机环境（Shared Hosting Environment）</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">模板引擎（Template Engines）</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">集成第三方代码（Working with Third-Party Code）</a>
<a class="list-group-item" href="./guide-tutorial-yii-as-micro-framework.html">使用 Yii 作为微框架（Using Yii as a micro framework）</a></div>
<a class="list-group-item" href="#navigation-565" data-toggle="collapse" data-parent="#navigation">小部件（Widgets） <b class="caret"></b></a><div id="navigation-565" class="submenu panel-collapse collapse"><a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-grid-gridview.html">GridView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-listview.html">ListView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-detailview.html">DetailView</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/guide-input-forms.html#activerecord-based-forms-activeform">ActiveForm</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-pjax.html">Pjax</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-menu.html">Menu</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-linkpager.html">LinkPager</a>
<a class="list-group-item" href="https://www.yiiframework.com/doc-2.0/yii-widgets-linksorter.html">LinkSorter</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-bootstrap/blob/master/docs/guide-zh-CN/README.md">Bootstrap Widgets</a>
<a class="list-group-item" href="https://github.com/yiisoft/yii2-jui/blob/master/docs/guide-zh-CN/README.md">jQuery UI Widgets</a></div>
<a class="list-group-item" href="#navigation-566" data-toggle="collapse" data-parent="#navigation">助手类（Helpers） <b class="caret"></b></a><div id="navigation-566" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">助手一览（Overview）</a>
<a class="list-group-item" href="./guide-helper-array.html">Array 助手（ArrayHelper）</a>
<a class="list-group-item" href="./guide-helper-html.html">Html 助手（Html）</a>
<a class="list-group-item" href="./guide-helper-url.html">Url 助手（Url）</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><h1>&#26368;&#20339;&#23433;&#20840;&#23454;&#36341; <span id="zui-jia-an-quan-shi-jian"></span><a href="#zui-jia-an-quan-shi-jian" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#ji-ben-zhun-ze">&#22522;&#26412;&#20934;&#21017;</a></li>
<li><a href="#bi-mian-sql-zhu-ru">&#36991;&#20813; SQL &#27880;&#20837;</a></li>
<li><a href="#fang-zhi-xss-gong-ji">&#38450;&#27490; XSS &#25915;&#20987;</a></li>
<li><a href="#fang-zhi-csrf-gong-ji">&#38450;&#27490; CSRF &#25915;&#20987;</a></li>
<li><a href="#fang-zhi-wen-jian-bao-lu">&#38450;&#27490;&#25991;&#20214;&#26292;&#38706;</a></li>
<li><a href="#zai-sheng-chan-huan-jing-guan-bi-diao-shi-xin-xi-he-gong-ju">&#22312;&#29983;&#20135;&#29615;&#22659;&#20851;&#38381;&#35843;&#35797;&#20449;&#24687;&#21644;&#24037;&#20855;</a></li>
<li><a href="#shi-yong-tls-shang-de-an-quan-lian-jie">&#20351;&#29992; TLS &#19978;&#30340;&#23433;&#20840;&#36830;&#25509;</a></li>
<li><a href="#an-quan-fu-wu-qi-pei-zhi">&#23433;&#20840;&#26381;&#21153;&#22120;&#37197;&#32622;</a></li></ol></div>
<p>&#19979;&#38754;&#65292;&#25105;&#20204;&#23558;&#20250;&#22238;&#39038;&#24120;&#35265;&#30340;&#23433;&#20840;&#21407;&#21017;&#65292;&#24182;&#20171;&#32461;&#22312;&#20351;&#29992; Yii &#24320;&#21457;&#24212;&#29992;&#31243;&#24207;&#26102;&#65292;&#22914;&#20309;&#36991;&#20813;&#28508;&#22312;&#23433;&#20840;&#23041;&#32961;&#12290;
&#22823;&#22810;&#25968;&#36825;&#20123;&#21407;&#21017;&#24182;&#38750;&#24744;&#29420;&#26377;&#65292;&#32780;&#26159;&#36866;&#29992;&#20110;&#32593;&#31449;&#25110;&#36719;&#20214;&#24320;&#21457;&#65292;
&#22240;&#27492;&#65292;&#24744;&#36824;&#21487;&#20197;&#25214;&#21040;&#26377;&#20851;&#36825;&#20123;&#32972;&#21518;&#30340;&#19968;&#33324;&#27010;&#24565;&#30340;&#36827;&#19968;&#27493;&#38405;&#35835;&#30340;&#38142;&#25509;&#12290;</p>
<h2>&#22522;&#26412;&#20934;&#21017; <span id="ji-ben-zhun-ze"></span><a href="#ji-ben-zhun-ze" class="hashlink">&para;</a></h2><p>&#26080;&#35770;&#26159;&#24320;&#21457;&#20309;&#31181;&#24212;&#29992;&#31243;&#24207;&#65292;&#25105;&#20204;&#37117;&#26377;&#20004;&#26465;&#22522;&#26412;&#30340;&#23433;&#20840;&#20934;&#21017;&#65306;</p>
<ol>
<li>&#36807;&#28388;&#36755;&#20837;</li>
<li>&#36716;&#20041;&#36755;&#20986;</li>
</ol>
<h3>&#36807;&#28388;&#36755;&#20837; <span id="guo-lu-shu-ru"></span><a href="#guo-lu-shu-ru" class="hashlink">&para;</a></h3><p>&#36807;&#28388;&#36755;&#20837;&#30340;&#24847;&#24605;&#26159;&#65292;&#29992;&#25143;&#36755;&#20837;&#19981;&#24212;&#35813;&#35748;&#20026;&#26159;&#23433;&#20840;&#30340;&#65292;&#20320;&#38656;&#35201;&#24635;&#26159;&#39564;&#35777;&#20320;&#33719;&#24471;&#30340;&#36755;&#20837;&#20540;&#26159;&#22312;&#20801;&#35768;&#33539;&#22260;&#20869;&#12290;
&#27604;&#22914;&#65292;&#25105;&#20204;&#20551;&#35774;&#21487;&#20197;&#36890;&#36807;&#19977;&#20010;&#23383;&#27573;&#23436;&#25104;&#25490;&#24207; <code>title</code>&#65292;<code>created_at</code> &#21644; <code>status</code>&#65292;&#28982;&#21518;&#65292;&#36825;&#20010;&#20540;&#26159;&#30001;&#29992;&#25143;&#36755;&#20837;&#25552;&#20379;&#30340;&#65292;
&#37027;&#20040;&#65292;&#26368;&#22909;&#22312;&#25105;&#20204;&#25509;&#25910;&#21442;&#25968;&#30340;&#26102;&#20505;&#65292;&#26816;&#26597;&#19968;&#19979;&#36825;&#20010;&#20540;&#26159;&#21542;&#26159;&#25351;&#23450;&#30340;&#33539;&#22260;&#12290;
&#23545;&#20110;&#22522;&#26412;&#30340; PHP &#32780;&#35328;&#65292;&#19978;&#36848;&#20570;&#27861;&#31867;&#20284;&#22914;&#19979;&#65306;</p>
<pre><code class="hljs php language-php">$sortBy = $_GET[<span class="hljs-string">'sort'</span>];
<span class="hljs-keyword">if</span> (!in_array($sortBy, [<span class="hljs-string">'title'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'status'</span>])) {
	<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">'Invalid sort value.'</span>);
}
</code></pre>
<p>&#22312; Yii &#20013;&#65292;&#24456;&#22823;&#21487;&#33021;&#24615;&#65292;&#20320;&#20250;&#20351;&#29992; <a href="guide-input-validation.html">&#34920;&#21333;&#26657;&#39564;&#22120;</a> &#26469;&#25191;&#34892;&#31867;&#20284;&#30340;&#26816;&#26597;&#12290;</p>
<p>&#36827;&#19968;&#27493;&#38405;&#35835;&#35813;&#20027;&#39064;&#65306;</p>
<ul>
<li><a href="https://owasp.org/www-community/vulnerabilities/Improper_Data_Validation">https://owasp.org/www-community/vulnerabilities/Improper_Data_Validation</a></li>
<li><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet">https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet</a></li>
</ul>
<h3>&#36716;&#20041;&#36755;&#20986; <span id="zhuan-yi-shu-chu"></span><a href="#zhuan-yi-shu-chu" class="hashlink">&para;</a></h3><p>&#36716;&#20041;&#36755;&#20986;&#30340;&#24847;&#24605;&#26159;&#65292;&#26681;&#25454;&#25105;&#20204;&#20351;&#29992;&#25968;&#25454;&#30340;&#19978;&#19979;&#25991;&#29615;&#22659;&#65292;&#25968;&#25454;&#38656;&#35201;&#34987;&#36716;&#20041;&#12290;&#27604;&#22914;&#65306;&#22312; HTML &#19978;&#19979;&#25991;&#65292;
&#20320;&#38656;&#35201;&#36716;&#20041; <code>&lt;</code>&#65292;<code>&gt;</code> &#20043;&#31867;&#30340;&#29305;&#27530;&#23383;&#31526;&#12290;&#22312; JavaScript &#25110;&#32773; SQL &#20013;&#65292;&#20063;&#26377;&#20854;&#20182;&#30340;&#29305;&#27530;&#21547;&#20041;&#30340;&#23383;&#31526;&#20018;&#38656;&#35201;&#34987;&#36716;&#20041;&#12290;
&#30001;&#20110;&#25163;&#21160;&#30340;&#32473;&#25152;&#29992;&#30340;&#36755;&#20986;&#36716;&#20041;&#23481;&#26131;&#20986;&#38169;&#65292;
Yii &#25552;&#20379;&#20102;&#22823;&#37327;&#30340;&#24037;&#20855;&#26469;&#22312;&#19981;&#21516;&#30340;&#19978;&#19979;&#25991;&#25191;&#34892;&#36716;&#20041;&#12290;</p>
<p>&#36827;&#19968;&#27493;&#38405;&#35835;&#35813;&#35805;&#39064;&#65306;</p>
<ul>
<li><a href="https://owasp.org/www-community/attacks/Command_Injection">https://owasp.org/www-community/attacks/Command_Injection</a></li>
<li><a href="https://owasp.org/www-community/attacks/Code_Injection">https://owasp.org/www-community/attacks/Code_Injection</a></li>
<li><a href="https://owasp.org/www-community/attacks/xss/">https://owasp.org/www-community/attacks/xss/</a></li>
</ul>
<h2>&#36991;&#20813; SQL &#27880;&#20837; <span id="bi-mian-sql-zhu-ru"></span><a href="#bi-mian-sql-zhu-ru" class="hashlink">&para;</a></h2><p>SQL &#27880;&#20837;&#21457;&#29983;&#22312;&#26597;&#35810;&#35821;&#21477;&#26159;&#30001;&#36830;&#25509;&#26410;&#36716;&#20041;&#30340;&#23383;&#31526;&#20018;&#29983;&#25104;&#30340;&#22330;&#26223;&#65292;&#27604;&#22914;&#65306;</p>
<pre><code class="hljs php language-php">$username = $_GET[<span class="hljs-string">'username'</span>];
$sql = <span class="hljs-string">"SELECT * FROM user WHERE username = '$username'"</span>;
</code></pre>
<p>&#38500;&#20102;&#25552;&#20379;&#27491;&#30830;&#30340;&#29992;&#25143;&#21517;&#22806;&#65292;&#25915;&#20987;&#32773;&#21487;&#20197;&#32473;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#36755;&#20837;&#31867;&#20284; <code>'; DROP TABLE user; --</code> &#30340;&#35821;&#21477;&#12290;
&#36825;&#23558;&#20250;&#23548;&#33268;&#29983;&#25104;&#22914;&#19979;&#30340; SQL&#65306;</p>
<pre><code class="hljs sql language-sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> username = <span class="hljs-string">''</span>; <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span>; <span class="hljs-comment">--'</span>
</code></pre>
<p>&#36825;&#26159;&#19968;&#20010;&#21512;&#27861;&#30340;&#26597;&#35810;&#35821;&#21477;&#65292;&#24182;&#23558;&#20250;&#25191;&#34892;&#20197;&#31354;&#30340;&#29992;&#25143;&#21517;&#25628;&#32034;&#29992;&#25143;&#25805;&#20316;&#65292;&#28982;&#21518;&#65292;&#21024;&#38500; <code>user</code> &#34920;&#12290;
&#36825;&#26497;&#26377;&#21487;&#33021;&#23548;&#33268;&#32593;&#31449;&#20986;&#38169;&#65292;&#25968;&#25454;&#20002;&#22833;&#12290;&#65288;&#20320;&#26159;&#21542;&#36827;&#34892;&#20102;&#35268;&#24459;&#30340;&#25968;&#25454;&#22791;&#20221;&#65311;&#65289;</p>
<p>&#22312; Yii &#20013;&#65292;&#22823;&#37096;&#20998;&#30340;&#25968;&#25454;&#26597;&#35810;&#26159;&#36890;&#36807; <a href="guide-db-active-record.html">Active Record</a> &#36827;&#34892;&#30340;&#65292;
&#32780;&#20854;&#26159;&#23436;&#20840;&#20351;&#29992; PDO &#39044;&#22788;&#29702;&#35821;&#21477;&#25191;&#34892; SQL &#26597;&#35810;&#30340;&#12290;&#22312;&#39044;&#22788;&#29702;&#35821;&#21477;&#20013;&#65292;&#19978;&#36848;&#31034;&#20363;&#20013;&#65292;&#26500;&#36896; SQL &#26597;&#35810;&#30340;&#22330;&#26223;&#26159;&#19981;&#21487;&#33021;&#21457;&#29983;&#30340;&#12290;</p>
<p>&#26377;&#26102;&#65292;&#20320;&#20173;&#38656;&#35201;&#20351;&#29992; <a href="guide-db-dao.html">raw queries</a> &#25110;&#32773; <a href="guide-db-query-builder.html">query builder</a>&#12290;
&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#20320;&#24212;&#35813;&#20351;&#29992;&#23433;&#20840;&#30340;&#26041;&#24335;&#20256;&#36882;&#21442;&#25968;&#12290;&#22914;&#26524;&#25968;&#25454;&#26159;&#25552;&#20379;&#32473;&#34920;&#21015;&#30340;&#20540;&#65292;&#26368;&#22909;&#20351;&#29992;&#39044;&#22788;&#29702;&#35821;&#21477;&#65306;</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// query builder</span>
$userIDs = (<span class="hljs-keyword">new</span> Query())
    -&gt;select(<span class="hljs-string">'id'</span>)
    -&gt;from(<span class="hljs-string">'user'</span>)
    -&gt;where(<span class="hljs-string">'status=:status'</span>, [<span class="hljs-string">':status'</span> =&gt; $status])
    -&gt;all();

<span class="hljs-comment">// DAO</span>
$userIDs = $connection
    -&gt;createCommand(<span class="hljs-string">'SELECT id FROM user where status=:status'</span>)
    -&gt;bindValues([<span class="hljs-string">':status'</span> =&gt; $status])
    -&gt;queryColumn();
</code></pre>
<p>&#22914;&#26524;&#25968;&#25454;&#26159;&#29992;&#20110;&#25351;&#23450;&#21015;&#30340;&#21517;&#23383;&#65292;&#25110;&#32773;&#34920;&#30340;&#21517;&#23383;&#65292;&#26368;&#22909;&#30340;&#26041;&#24335;&#26159;&#21482;&#20801;&#35768;&#39044;&#23450;&#20041;&#30340;&#26522;&#20030;&#20540;&#12290;</p>
<pre><code class="hljs php language-php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionList</span><span class="hljs-params">($orderBy = null)</span>
</span>{
    <span class="hljs-keyword">if</span> (!in_array($orderBy, [<span class="hljs-string">'name'</span>, <span class="hljs-string">'status'</span>])) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadRequestHttpException(<span class="hljs-string">'Only name and status are allowed to order by.'</span>)
    }

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>&#22914;&#26524;&#19978;&#36848;&#26041;&#27861;&#19981;&#34892;&#65292;&#34920;&#21517;&#25110;&#32773;&#21015;&#21517;&#24212;&#35813;&#34987;&#36716;&#20041;&#12290;Yii &#38024;&#23545;&#36825;&#31181;&#36716;&#20041;&#25552;&#20379;&#20102;&#19968;&#20010;&#29305;&#27530;&#30340;&#35821;&#27861;&#65292;
&#36825;&#26679;&#21487;&#20197;&#22312;&#25152;&#26377;&#25903;&#25345;&#30340;&#25968;&#25454;&#24211;&#37117;&#20351;&#29992;&#19968;&#22871;&#26041;&#26696;&#12290;</p>
<pre><code class="hljs php language-php">$sql = <span class="hljs-string">"SELECT COUNT([[$column]]) FROM {{table}}"</span>;
$rowCount = $connection-&gt;createCommand($sql)-&gt;queryScalar();
</code></pre>
<p>&#20320;&#21487;&#20197;&#22312; <a href="guide-db-dao.html#quoting-table-and-column-names">Quoting Table and Column Names</a> &#20013;&#33719;&#21462;&#26356;&#22810;&#30340;&#35821;&#27861;&#32454;&#33410;&#12290;</p>
<p>&#36827;&#19968;&#27493;&#38405;&#35835;&#35813;&#35805;&#39064;&#65306;</p>
<ul>
<li><a href="https://owasp.org/www-community/attacks/SQL_Injection">https://owasp.org/www-community/attacks/SQL_Injection</a></li>
</ul>
<h2>&#38450;&#27490; XSS &#25915;&#20987; <span id="fang-zhi-xss-gong-ji"></span><a href="#fang-zhi-xss-gong-ji" class="hashlink">&para;</a></h2><p>XSS &#25110;&#32773;&#36328;&#31449;&#33050;&#26412;&#21457;&#29983;&#22312;&#36755;&#20986; HTML &#21040;&#27983;&#35272;&#22120;&#26102;&#65292;&#36755;&#20986;&#20869;&#23481;&#27809;&#26377;&#27491;&#30830;&#30340;&#36716;&#20041;&#12290;
&#20363;&#22914;&#65292;&#22914;&#26524;&#29992;&#25143;&#21487;&#20197;&#36755;&#20837;&#20854;&#21517;&#31216;&#65292;&#37027;&#20040;&#20182;&#36755;&#20837; <code>&lt;script&gt;alert('Hello!');&lt;/script&gt;</code> &#32780;&#38750;&#20854;&#21517;&#23383; <code>Alexander</code>&#65292;
&#25152;&#26377;&#36755;&#20986;&#27809;&#26377;&#36716;&#20041;&#30452;&#25509;&#36755;&#20986;&#29992;&#25143;&#21517;&#30340;&#39029;&#38754;&#37117;&#20250;&#25191;&#34892; JavaScript &#20195;&#30721; <code>alert('Hello!');</code>&#65292;
&#36825;&#20250;&#23548;&#33268;&#27983;&#35272;&#22120;&#39029;&#38754;&#19978;&#20986;&#29616;&#19968;&#20010;&#35686;&#21578;&#24377;&#20986;&#26694;&#12290;&#23601;&#20855;&#20307;&#30340;&#31449;&#28857;&#32780;&#35328;&#65292;&#38500;&#20102;&#36825;&#31181;&#26080;&#24847;&#20041;&#30340;&#35686;&#21578;&#36755;&#20986;&#22806;&#65292;
&#36825;&#26679;&#30340;&#33050;&#26412;&#21487;&#20197;&#20197;&#20320;&#30340;&#21517;&#20041;&#21457;&#36865;&#19968;&#20123;&#28040;&#24687;&#21040;&#21518;&#21488;&#65292;&#29978;&#33267;&#25191;&#34892;&#19968;&#20123;&#38134;&#34892;&#20132;&#26131;&#34892;&#20026;&#12290;</p>
<p>&#36991;&#20813; XSS &#25915;&#20987;&#22312; Yii &#20013;&#38750;&#24120;&#31616;&#21333;&#65292;&#26377;&#22914;&#19979;&#20004;&#31181;&#19968;&#33324;&#24773;&#20917;&#65306;</p>
<ol>
<li>&#20320;&#24076;&#26395;&#25968;&#25454;&#20197;&#32431;&#25991;&#26412;&#36755;&#20986;&#12290;</li>
<li>&#20320;&#24076;&#26395;&#25968;&#25454;&#20197; HTML &#24418;&#24335;&#36755;&#20986;&#12290;</li>
</ol>
<p>&#22914;&#26524;&#20320;&#38656;&#35201;&#30340;&#26159;&#32431;&#25991;&#26412;&#65292;&#20320;&#21487;&#20197;&#22914;&#19979;&#31616;&#21333;&#30340;&#36716;&#20041;&#65306;</p>
<pre><code class="hljs xml language-html"><span class="php"><span class="hljs-meta">&lt;?</span>= \yii\helpers\Html::encode($username) <span class="hljs-meta">?&gt;</span></span>
</code></pre>
<p>&#22914;&#26524;&#26159; HTML&#65292;&#25105;&#20204;&#21487;&#20197;&#29992; HtmlPurifier &#24110;&#21161;&#31867;&#26469;&#25191;&#34892;&#65306;</p>
<pre><code class="hljs xml language-html"><span class="php"><span class="hljs-meta">&lt;?</span>= \yii\helpers\HtmlPurifier::process($description) <span class="hljs-meta">?&gt;</span></span>
</code></pre>
<p>&#27880;&#24847; HtmlPurifier &#24110;&#21161;&#31867;&#30340;&#22788;&#29702;&#36807;&#31243;&#36739;&#20026;&#36153;&#26102;&#65292;&#24314;&#35758;&#22686;&#21152;&#32531;&#23384;&#12290;</p>
<p>&#36827;&#19968;&#27493;&#38405;&#35835;&#35813;&#35805;&#39064;&#65306;</p>
<ul>
<li><a href="https://owasp.org/www-community/attacks/xss/">https://owasp.org/www-community/attacks/xss/</a></li>
</ul>
<h2>&#38450;&#27490; CSRF &#25915;&#20987; <span id="fang-zhi-csrf-gong-ji"></span><a href="#fang-zhi-csrf-gong-ji" class="hashlink">&para;</a></h2><p>CSRF &#26159;&#36328;&#31449;&#35831;&#27714;&#20266;&#36896;&#30340;&#32553;&#20889;&#12290;&#36825;&#20010;&#25915;&#20987;&#24605;&#24819;&#28304;&#33258;&#35768;&#22810;&#24212;&#29992;&#31243;&#24207;&#20551;&#35774;&#26469;&#33258;&#29992;&#25143;&#30340;&#27983;&#35272;&#22120;&#35831;&#27714;&#26159;&#30001;&#29992;&#25143;&#33258;&#24049;&#20135;&#29983;&#30340;&#65292;
&#32780;&#20107;&#23454;&#24182;&#38750;&#22914;&#27492;&#12290;</p>
<p>&#20363;&#22914;&#65292;&#32593;&#31449; <code>an.example.com</code> &#26377;&#19968;&#20010; <code>/logout</code> &#32593;&#22336;&#65292;&#24403;&#20351;&#29992;&#31616;&#21333;&#30340; GET &#35831;&#27714;&#35775;&#38382;&#26102;, &#35760;&#24405;&#29992;&#25143;&#36864;&#20986;&#12290;
&#21482;&#35201;&#29992;&#25143;&#30340;&#35831;&#27714;&#19968;&#20999;&#27491;&#24120;&#65292;&#20294;&#26159;&#26377;&#19968;&#22825;&#22351;&#20154;&#20204;&#25925;&#24847;&#22312;&#29992;&#25143;&#32463;&#24120;&#35775;&#38382;&#30340;&#35770;&#22363;&#19978;&#25918;&#19978; <code>&lt;img src="https://an.example.com/logout"&gt;</code>&#12290;
&#27983;&#35272;&#22120;&#22312;&#35831;&#27714;&#22270;&#20687;&#25110;&#35831;&#27714;&#39029;&#38754;&#20043;&#38388;&#27809;&#26377;&#20219;&#20309;&#21306;&#21035;&#65292;
&#25152;&#20197;&#24403;&#29992;&#25143;&#25171;&#24320;&#19968;&#20010;&#24102;&#26377;&#36825;&#26679;&#19968;&#20010;&#34987;&#25805;&#20316;&#36807;&#30340; <code>&lt;img&gt;</code> &#26631;&#31614;&#30340;&#39029;&#38754;&#26102;&#65292;
&#27983;&#35272;&#22120;&#23558; GET &#35831;&#27714;&#21457;&#36865;&#21040;&#35813; URL&#65292;&#29992;&#25143;&#23558;&#20174; <code>an.example.com</code> &#27880;&#38144;&#12290;</p>
<p>&#36825;&#26159; CSRF &#25915;&#20987;&#22914;&#20309;&#36816;&#20316;&#30340;&#22522;&#26412;&#24605;&#36335;&#12290;&#21487;&#20197;&#35828;&#29992;&#25143;&#36864;&#20986;&#24182;&#19981;&#26159;&#19968;&#20214;&#20005;&#37325;&#30340;&#20107;&#24773;&#65292;
&#28982;&#32780;&#36825;&#20165;&#20165;&#26159;&#19968;&#20010;&#20363;&#23376;&#65292;&#20351;&#29992;&#36825;&#31181;&#26041;&#27861;&#21487;&#20197;&#20570;&#26356;&#22810;&#30340;&#20107;&#24773;&#65292;&#20363;&#22914;&#35302;&#21457;&#20184;&#27454;&#25110;&#32773;&#26159;&#25913;&#21464;&#25968;&#25454;&#12290;
&#24819;&#35937;&#19968;&#19979;&#22914;&#26524;&#26576;&#20010;&#32593;&#31449;&#26377;&#19968;&#20010;&#36825;&#26679;&#30340; <code>https://an.example.com/purse/transfer?to=anotherUser&amp;amount=2000</code> &#32593;&#22336;&#12290; 
&#20351;&#29992; GET &#35831;&#27714;&#35775;&#38382;&#23427;&#20250;&#23548;&#33268;&#20174;&#25480;&#26435;&#29992;&#25143;&#36134;&#25143;&#36716;&#36134; $2000 &#32473; <code>anotherUser</code>&#12290;
&#25105;&#20204;&#30693;&#36947;&#65292;&#27983;&#35272;&#22120;&#23558;&#22987;&#32456;&#21457;&#36865; GET &#35831;&#27714;&#26469;&#21152;&#36733;&#22270;&#20687;&#65292;
&#25152;&#20197;&#25105;&#20204;&#21487;&#20197;&#20462;&#25913;&#20195;&#30721;&#20197;&#20165;&#25509;&#21463;&#35813; URL &#19978;&#30340; POST &#35831;&#27714;&#12290;
&#19981;&#24184;&#30340;&#26159;&#65292;&#36825;&#24182;&#19981;&#20250;&#25327;&#25937;&#25105;&#20204;&#65292;&#22240;&#20026;&#25915;&#20987;&#32773;&#21487;&#20197;&#25918;&#32622;&#19968;&#20123; JavaScript &#20195;&#30721;&#32780;&#19981;&#26159; <code>&lt;img&gt;</code> &#26631;&#31614;&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#21521;&#35813; URL &#21457;&#36865; POST &#35831;&#27714;&#12290;</p>
<p>&#20986;&#20110;&#36825;&#20010;&#21407;&#22240;&#65292;Yii &#24212;&#29992;&#20854;&#20182;&#26426;&#21046;&#26469;&#38450;&#27490; CSRF &#25915;&#20987;&#12290;</p>
<p>&#20026;&#20102;&#36991;&#20813; CSRF &#25915;&#20987;&#65292;&#20320;&#24635;&#26159;&#38656;&#35201;&#65306;</p>
<ol>
<li>&#36981;&#24490; HTTP &#20934;&#21017;&#65292;&#27604;&#22914; GET &#19981;&#24212;&#35813;&#25913;&#21464;&#24212;&#29992;&#30340;&#29366;&#24577;&#12290;
&#26377;&#20851;&#35814;&#32454;&#20449;&#24687;&#65292;&#35831;&#21442;&#38405; <a href="https://www.rfc-editor.org/rfc/rfc9110.html#name-method-definitions">RFC2616</a>&#12290;</li>
<li>&#20445;&#35777; Yii CSRF &#20445;&#25252;&#24320;&#21551;&#12290;</li>
</ol>
<p>&#26377;&#30340;&#26102;&#20505;&#20320;&#38656;&#35201;&#23545;&#27599;&#20010;&#25511;&#21046;&#22120;&#21644;/&#25110;&#26041;&#27861;&#20351;&#29992;&#31105;&#29992; CSRF&#12290;&#21487;&#20197;&#36890;&#36807;&#35774;&#32622;&#20854;&#23646;&#24615;&#26469;&#23454;&#29616;&#65306;</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> $enableCsrfValidation = <span class="hljs-keyword">false</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionIndex</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// CSRF validation will not be applied to this and other actions</span>
    }

}
</code></pre>
<p>&#35201;&#23545;&#27599;&#20010;&#33258;&#23450;&#20041;&#26041;&#27861;&#31105;&#29992; CSRF &#39564;&#35777;&#65292;&#24744;&#21487;&#20197;&#20351;&#29992;&#65306;</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beforeAction</span><span class="hljs-params">($action)</span>
    </span>{
        <span class="hljs-comment">// ...set `$this-&gt;enableCsrfValidation` here based on some conditions...</span>
        <span class="hljs-comment">// call parent method that will check CSRF if such property is true.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">parent</span>::beforeAction($action);
    }
}
</code></pre>
<p>&#22312; <a href="guide-structure-controllers.html#standalone-actions">standalone actions</a> &#31105;&#29992; CSRF &#24517;&#39035;&#22312; <code>init()</code> &#26041;&#27861;&#20013;&#35774;&#32622;&#12290;
&#19981;&#35201;&#25226;&#36825;&#27573;&#20195;&#30721;&#25918;&#22312; <code>beforeRun()</code> &#26041;&#27861;&#20013;&#65292;&#22240;&#20026;&#23427;&#19981;&#20250;&#36215;&#20219;&#20309;&#20316;&#29992;&#12290;</p>
<pre><code class="hljs php language-php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">components</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">base</span>\<span class="hljs-title">Action</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContactAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Action</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">parent</span>::init();
        <span class="hljs-keyword">$this</span>-&gt;controller-&gt;enableCsrfValidation = <span class="hljs-keyword">false</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span><span class="hljs-params">()</span>
    </span>{
          $model = <span class="hljs-keyword">new</span> ContactForm();
          $request = Yii::$app-&gt;request;
          <span class="hljs-keyword">if</span> ($request-&gt;referrer === <span class="hljs-string">'yiipowered.com'</span>
              &amp;&amp; $model-&gt;load($request-&gt;post())
              &amp;&amp; $model-&gt;validate()
          ) {
              $model-&gt;sendEmail();
          }
    }
}
</code></pre>
<blockquote class="warning"><p><strong>&#35686;&#21578;&#65306; </strong>&#31105;&#29992; CSRF &#23558;&#20801;&#35768;&#20219;&#20309;&#31449;&#28857;&#21521;&#24744;&#30340;&#31449;&#28857;&#21457;&#36865; POST &#35831;&#27714;&#12290;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#23454;&#26045;&#39069;&#22806;&#39564;&#35777;&#38750;&#24120;&#37325;&#35201;&#65292;&#20363;&#22914;&#26816;&#26597; IP &#22320;&#22336;&#25110;&#31192;&#23494;&#20196;&#29260;&#12290;</p>
</blockquote>
<p>&#36827;&#19968;&#27493;&#38405;&#35835;&#35813;&#35805;&#39064;&#65306;</p>
<ul>
<li><a href="https://owasp.org/www-community/attacks/csrf">https://owasp.org/www-community/attacks/csrf</a></li>
</ul>
<h2>&#38450;&#27490;&#25991;&#20214;&#26292;&#38706; <span id="fang-zhi-wen-jian-bao-lu"></span><a href="#fang-zhi-wen-jian-bao-lu" class="hashlink">&para;</a></h2><p>&#40664;&#35748;&#30340;&#26381;&#21153;&#22120; webroot &#30446;&#24405;&#25351;&#21521;&#21253;&#21547;&#26377; <code>index.php</code> &#30340; <code>web</code> &#30446;&#24405;&#12290;&#22312;&#20849;&#20139;&#25176;&#31649;&#29615;&#22659;&#19979;&#65292;&#36825;&#26679;&#26159;&#19981;&#21487;&#33021;&#30340;&#65292;
&#36825;&#26679;&#23548;&#33268;&#20102;&#25152;&#26377;&#30340;&#20195;&#30721;&#65292;&#37197;&#32622;&#65292;&#26085;&#24535;&#37117;&#22312;webroot&#30446;&#24405;&#12290;</p>
<p>&#22914;&#26524;&#26159;&#36825;&#26679;&#65292;&#21035;&#24536;&#20102;&#25298;&#32477;&#38500;&#20102; <code>web</code> &#30446;&#24405;&#20197;&#22806;&#30340;&#30446;&#24405;&#30340;&#35775;&#38382;&#26435;&#38480;&#12290;
&#22914;&#26524;&#27809;&#27861;&#36825;&#26679;&#20570;&#65292;&#32771;&#34385;&#23558;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#25176;&#31649;&#22312;&#20854;&#20182;&#22320;&#26041;&#12290;</p>
<h2>&#22312;&#29983;&#20135;&#29615;&#22659;&#20851;&#38381;&#35843;&#35797;&#20449;&#24687;&#21644;&#24037;&#20855; <span id="zai-sheng-chan-huan-jing-guan-bi-diao-shi-xin-xi-he-gong-ju"></span><a href="#zai-sheng-chan-huan-jing-guan-bi-diao-shi-xin-xi-he-gong-ju" class="hashlink">&para;</a></h2><p>&#22312;&#35843;&#35797;&#27169;&#24335;&#19979;&#65292; Yii &#23637;&#31034;&#20102;&#22823;&#37327;&#30340;&#38169;&#35823;&#20449;&#24687;&#65292;&#36825;&#26679;&#26159;&#23545;&#24320;&#21457;&#26377;&#29992;&#30340;&#12290;
&#21516;&#26679;&#65292;&#36825;&#20123;&#35843;&#35797;&#20449;&#24687;&#23545;&#20110;&#25915;&#20987;&#32773;&#32780;&#35328;&#20063;&#26159;&#26041;&#20415;&#20854;&#29992;&#20110;&#30772;&#35299;&#25968;&#25454;&#32467;&#26500;&#65292;&#37197;&#32622;&#20540;&#65292;&#20197;&#21450;&#20320;&#30340;&#37096;&#20998;&#20195;&#30721;&#12290;
&#27704;&#36828;&#19981;&#35201;&#22312;&#29983;&#20135;&#27169;&#24335;&#19979;&#23558;&#20320;&#30340; <code>index.php</code> &#20013;&#30340; <code>YII_DEBUG</code> &#35774;&#32622;&#20026; <code>true</code>&#12290;</p>
<p>&#20320;&#21516;&#26679;&#20063;&#19981;&#24212;&#35813;&#22312;&#29983;&#20135;&#27169;&#24335;&#19979;&#24320;&#21551; Gii&#12290;&#23427;&#21487;&#20197;&#34987;&#29992;&#20110;&#33719;&#21462;&#25968;&#25454;&#32467;&#26500;&#20449;&#24687;&#65292;
&#20195;&#30721;&#65292;&#20197;&#21450;&#31616;&#21333;&#30340;&#29992; Gii &#29983;&#25104;&#30340;&#20195;&#30721;&#35206;&#30422;&#20320;&#30340;&#20195;&#30721;&#12290;</p>
<p>&#35843;&#35797;&#24037;&#20855;&#26639;&#21516;&#26679;&#20063;&#24212;&#35813;&#36991;&#20813;&#22312;&#29983;&#20135;&#29615;&#22659;&#20986;&#29616;&#65292;&#38500;&#38750;&#38750;&#24120;&#26377;&#24517;&#35201;&#12290;&#23427;&#23558;&#20250;&#26292;&#38706;&#25152;&#26377;&#30340;&#24212;&#29992;&#21644;&#37197;&#32622;&#30340;&#35814;&#24773;&#20449;&#24687;&#12290;
&#22914;&#26524;&#20320;&#30830;&#23450;&#38656;&#35201;&#65292;&#21453;&#22797;&#30830;&#35748;&#20854;&#35775;&#38382;&#26435;&#38480;&#38480;&#23450;&#22312;&#20320;&#33258;&#24049;&#30340; IP&#12290;</p>
<p>&#36827;&#19968;&#27493;&#38405;&#35835;&#35813;&#35805;&#39064;&#65306;</p>
<ul>
<li><a href="guide-https://owasp.org/www-project-.net/articles/Exception_Handling.html">https://owasp.org/www-project-.net/articles/Exception_Handling.md</a></li>
<li><a href="https://owasp.org/www-pdf-archive/OWASP_Top_10_2007.pdf">https://owasp.org/www-pdf-archive/OWASP_Top_10_2007.pdf</a> (A6 - Information Leakage and Improper Error Handling)</li>
</ul>
<h2>&#20351;&#29992; TLS &#19978;&#30340;&#23433;&#20840;&#36830;&#25509; <span id="shi-yong-tls-shang-de-an-quan-lian-jie"></span><a href="#shi-yong-tls-shang-de-an-quan-lian-jie" class="hashlink">&para;</a></h2><p>Yii &#25552;&#20379;&#20381;&#36182; cookie &#21644;/&#25110; PHP &#20250;&#35805;&#30340;&#21151;&#33021;&#12290;&#22914;&#26524;&#24744;&#30340;&#36830;&#25509;&#21463;&#21040;&#23041;&#32961;&#65292;&#36825;&#20123;&#21487;&#33021;&#20250;&#24456;&#23481;&#26131;&#21463;&#21040;&#25915;&#20987;&#12290;
&#22914;&#26524;&#24212;&#29992;&#31243;&#24207;&#36890;&#36807; TLS &#20351;&#29992;&#23433;&#20840;&#36830;&#25509;&#65292;&#21017;&#39118;&#38505;&#20250;&#38477;&#20302;&#12290;</p>
<p>&#26377;&#20851;&#22914;&#20309;&#37197;&#32622;&#23427;&#30340;&#35828;&#26126;&#65292;&#35831;&#21442;&#38405;&#24744;&#30340; Web &#26381;&#21153;&#22120;&#25991;&#26723;&#12290;
&#24744;&#36824;&#21487;&#20197;&#21442;&#32771; H5BP &#39033;&#30446;&#25552;&#20379;&#30340;&#31034;&#20363;&#37197;&#32622;&#65306;</p>
<ul>
<li><a href="https://github.com/h5bp/server-configs-nginx">Nginx</a>&#12290;</li>
<li><a href="https://github.com/h5bp/server-configs-apache">Apache</a>&#12290;</li>
<li><a href="https://github.com/h5bp/server-configs-iis">IIS</a>&#12290;</li>
<li><a href="https://github.com/h5bp/server-configs-lighttpd">Lighttpd</a>&#12290;</li>
</ul>
<h2>&#23433;&#20840;&#26381;&#21153;&#22120;&#37197;&#32622; <span id="an-quan-fu-wu-qi-pei-zhi"></span><a href="#an-quan-fu-wu-qi-pei-zhi" class="hashlink">&para;</a></h2><p>&#26412;&#33410;&#30340;&#30446;&#30340;&#26159;&#24378;&#35843;&#22312;&#20026;&#22522;&#20110; Yii &#30340;&#32593;&#31449;&#25552;&#20379;&#26381;&#21153;&#37197;&#32622;&#26102;&#38656;&#35201;&#32771;&#34385;&#30340;&#39118;&#38505;&#12290; 
&#38500;&#20102;&#36825;&#37324;&#28041;&#21450;&#30340;&#35201;&#28857;&#20043;&#22806;&#65292;
&#21487;&#33021;&#36824;&#26377;&#20854;&#20182;&#19982;&#23433;&#20840;&#30456;&#20851;&#30340;&#37197;&#32622;&#36873;&#39033;&#65292;
&#25152;&#20197;&#19981;&#35201;&#35748;&#20026;&#36825;&#37096;&#20998;&#26159;&#23436;&#25972;&#30340;&#12290;</p>
<h3>&#36991;&#20813; <code>Host</code>-header &#25915;&#20987; <span id="bi-mian-host-header-gong-ji"></span><a href="#bi-mian-host-header-gong-ji" class="hashlink">&para;</a></h3><p>&#20687; <a href="./yii-web-urlmanager.html">yii\web\UrlManager</a> &#21644; <a href="./yii-helpers-url.html">yii\helpers\Url</a> &#36825;&#26679;&#30340;&#31867;&#20250;&#20351;&#29992; 
<a href="./yii-web-request.html#getHostInfo()-detail">currently requested host name</a> &#26469;&#29983;&#25104;&#38142;&#25509;&#12290;
&#22914;&#26524; Web &#26381;&#21153;&#22120;&#37197;&#32622;&#20026;&#29420;&#31435;&#20110; <code>Host</code> &#26631;&#22836;&#30340;&#20540;&#25552;&#20379;&#30456;&#21516;&#30340;&#31449;&#28857;&#65292;&#36825;&#20010;&#20449;&#24687;&#24182;&#19981;&#21487;&#38752;&#65292;
&#24182;&#19988; <a href="https://www.acunetix.com/vulnerabilities/web/host-header-attack">&#21487;&#33021;&#30001;&#21457;&#36865;HTTP&#35831;&#27714;&#30340;&#29992;&#25143;&#20266;&#36896;</a>&#12290;
&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#24744;&#24212;&#35813;&#20462;&#22797;&#24744;&#30340; Web &#26381;&#21153;&#22120;&#37197;&#32622;&#20197;&#20415;&#20165;&#20026;&#25351;&#23450;&#30340;&#20027;&#26426;&#21517;&#25552;&#20379;&#31449;&#28857;&#26381;&#21153;
&#25110;&#32773;&#36890;&#36807;&#35774;&#32622; <code>request</code> &#24212;&#29992;&#31243;&#24207;&#32452;&#20214;&#30340; <a href="./yii-web-request.html#setHostInfo()-detail">hostInfo</a> &#23646;&#24615;&#26469;&#26174;&#24335;&#35774;&#32622;&#25110;&#36807;&#28388;&#35813;&#20540;&#12290;</p>
<p>&#26377;&#20851;&#20110;&#26381;&#21153;&#22120;&#37197;&#32622;&#30340;&#26356;&#22810;&#20449;&#24687;&#65292;&#35831;&#21442;&#38405;&#24744;&#30340; web &#26381;&#21153;&#22120;&#30340;&#25991;&#26723;&#65306;</p>
<ul>
<li>Apache 2&#65306;<a href="https://httpd.apache.org/docs/trunk/vhosts/examples.html#defaultallports">https://httpd.apache.org/docs/trunk/vhosts/examples.html#defaultallports</a></li>
<li>Nginx&#65306;<a href="https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/">https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/</a></li>
</ul>
<p>&#22914;&#26524;&#24744;&#26080;&#26435;&#35775;&#38382;&#26381;&#21153;&#22120;&#37197;&#32622;&#65292;&#24744;&#21487;&#20197;&#22312;&#24212;&#29992;&#31243;&#24207;&#32423;&#21035;&#35774;&#32622; <a href="./yii-filters-hostcontrol.html">yii\filters\HostControl</a> &#36807;&#28388;&#22120;&#65292;
&#20197;&#38450;&#27492;&#31867;&#30340;&#25915;&#20987;&#12290;</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// Web Application configuration file</span>
<span class="hljs-keyword">return</span> [
    <span class="hljs-string">'as hostControl'</span> =&gt; [
        <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\filters\HostControl'</span>,
        <span class="hljs-string">'allowedHosts'</span> =&gt; [
            <span class="hljs-string">'example.com'</span>,
            <span class="hljs-string">'*.example.com'</span>,
        ],
        <span class="hljs-string">'fallbackHostInfo'</span> =&gt; <span class="hljs-string">'https://example.com'</span>,
    ],
    <span class="hljs-comment">// ...</span>
];
</code></pre>
<blockquote class="note"><p><strong>&#27880;&#24847;&#65306; </strong>&#24744;&#24212;&#35813;&#22987;&#26356;&#20542;&#21521;&#20110;&#20351;&#29992; web &#26381;&#21153;&#22120;&#37197;&#32622; 'host header attack' &#20445;&#25252;&#32780;&#19981;&#26159;&#20351;&#29992;&#36807;&#28388;&#22120;&#12290;
  &#20165;&#24403;&#26381;&#21153;&#22120;&#37197;&#32622;&#35774;&#32622;&#19981;&#21487;&#29992;&#26102; <a href="./yii-filters-hostcontrol.html">yii\filters\HostControl</a> &#25165;&#24212;&#35813;&#34987;&#20351;&#29992;&#12290;</p>
</blockquote>
</body></html>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Mon, 25 Mar 2024 04:16:20 +0000</small></p>
    Powered by <a href="https://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script>jQuery(function ($) {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
